# ğŸ“š 5.è¯·æ±‚5sæœªå®Œæˆå°±ç»ˆæ­¢

## ğŸ’» ä»£ç å®ç°
```typescript
// AbortController å®ƒèƒ½å¤Ÿä¸­æ­¢ fetch è¯·æ±‚ã€å„ç§å“åº”ä¸»ä½“æˆ–è€…æµçš„æ¶ˆè€—ã€‚
// @url https://juejin.cn/post/7112699475327615006

/**
 * å‘èµ·è¯·æ±‚ï¼Œå¦‚æœè¶…è¿‡æŒ‡å®šæ—¶é—´æœªå®Œæˆåˆ™ç»ˆæ­¢
 * @param {string} url è¯·æ±‚åœ°å€
 * @param {number} timeout è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
 */
async function fetchWithTimeout(url, timeout = 5000) {
    const controller = new AbortController(); // ps:å¯ä»¥ä¸¢å¼ƒè¯·æ±‚çš„API
    const signal = controller.signal;

    // åˆ›å»ºä¸€ä¸ªè¶…æ—¶Promise
    const timeoutPromise = new Promise((_, reject) => {
        setTimeout(() => {
            controller.abort();
            reject(new Error(`è¯·æ±‚è¶…æ—¶: ${timeout}ms`));
        }, timeout);
    });

    try {
        // ä½¿ç”¨ Promise.race ç«äº‰ï¼Œè°å…ˆå®Œæˆç”¨è°çš„ç»“æœ
        const response = await Promise.race([
            fetch(url, { signal }),
            timeoutPromise
        ]);
        return await response.json();
    } catch (error) {
        if (error.name === 'AbortError') {
            throw new Error('è¯·æ±‚å·²è¢«ç»ˆæ­¢');
        }
        throw error;
    }
}

// ä½¿ç”¨ç¤ºä¾‹
async function example() {
    try {
        // æ¨¡æ‹Ÿä¸€ä¸ªå¯èƒ½è¶…æ—¶çš„è¯·æ±‚
        const data = await fetchWithTimeout('https://api.example.com/data', 5000);
        console.log('è¯·æ±‚æˆåŠŸ:', data);
    } catch (error) {
        console.error('è¯·æ±‚å¤±è´¥:', error.message);
    }
}
```
